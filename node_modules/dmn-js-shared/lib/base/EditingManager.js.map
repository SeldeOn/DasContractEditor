{"version":3,"sources":["../../src/base/EditingManager.js"],"names":["Manager","Ids","isAny","EditingManager","options","on","event","error","_collectIds","definitions","elementsById","_moddle","ids","clear","viewer","elements","viewsChanged","some","e","_updateViews","moddle","$model","id","claim"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,OAAP,MAAoB,WAApB;AAEA,OAAOC,GAAP,MAAgB,KAAhB;AAEA,SAASC,KAAT,QAAsB,mBAAtB;;IAGqBC,c;;;;;;;;;;;;;WAEnB,eAAMC,OAAN,EAAe;AAAA;;AAEb,gFAAYA,OAAZ,EAFa,CAIb;;;AACA,WAAKC,EAAL,CAAQ,uBAAR,EAAiC,UAACC,KAAD,EAAW;AAC1C,YAAI,CAACA,KAAK,CAACC,KAAX,EAAkB;AAChB,UAAA,KAAI,CAACC,WAAL,CAAiBF,KAAK,CAACG,WAAvB,EAAoCH,KAAK,CAACI,YAA1C;AACD;AACF,OAJD;AAMA,WAAKL,EAAL,CAAQ,SAAR,EAAmB,YAAM;AACvB,QAAA,KAAI,CAACM,OAAL,CAAaC,GAAb,CAAiBC,KAAjB;AACD,OAFD;AAIA,WAAKR,EAAL,CAAQ,gBAAR,EAA0B,gBAAgB;AAAA,YAAbS,MAAa,QAAbA,MAAa;AAExCA,QAAAA,MAAM,CAACT,EAAP,CAAU,kBAAV,EAA8B,iBAAkB;AAAA,cAAfU,QAAe,SAAfA,QAAe;AAE9C,cAAIC,YAAY,GAAGD,QAAQ,CAACE,IAAT,CAAc,UAASC,CAAT,EAAY;AAC3C,mBAAOhB,KAAK,CAACgB,CAAD,EAAI,CAAE,cAAF,EAAkB,iBAAlB,CAAJ,CAAZ;AACD,WAFkB,CAAnB;;AAIA,cAAIF,YAAJ,EAAkB;AAChB,YAAA,KAAI,CAACG,YAAL;AACD;AACF,SATD;AAUD,OAZD;AAaD;AAED;AACF;AACA;AACA;AACA;AACA;AACA;;;;WACE,qBAAYV,WAAZ,EAAyBC,YAAzB,EAAuC;AAErC,UAAIU,MAAM,GAAGX,WAAW,CAACY,MAAzB;AAAA,UACIT,GAAG,GAAGQ,MAAM,CAACR,GADjB;AAAA,UAEIU,EAFJ,CAFqC,CAMrC;;AACAV,MAAAA,GAAG,CAACC,KAAJ;;AAEA,WAAKS,EAAL,IAAWZ,YAAX,EAAyB;AACvBE,QAAAA,GAAG,CAACW,KAAJ,CAAUD,EAAV,EAAcZ,YAAY,CAACY,EAAD,CAA1B;AACD;AACF;;;WAED,uBAAclB,OAAd,EAAuB;AACrB,UAAIgB,MAAM,qFAAuBhB,OAAvB,CAAV,CADqB,CAGrB;AACA;AACA;;;AACAgB,MAAAA,MAAM,CAACR,GAAP,GAAa,IAAIX,GAAJ,CAAQ,CAAE,EAAF,EAAM,EAAN,EAAU,CAAV,CAAR,CAAb;AAEA,aAAOmB,MAAP;AACD;;;;EA9DyCpB,O;;SAAvBG,c","sourcesContent":["import Manager from './Manager';\n\nimport Ids from 'ids';\n\nimport { isAny } from '../util/ModelUtil';\n\n\nexport default class EditingManager extends Manager {\n\n  _init(options) {\n\n    super._init(options);\n\n    // hook ID collection into the modeler\n    this.on('import.parse.complete', (event) => {\n      if (!event.error) {\n        this._collectIds(event.definitions, event.elementsById);\n      }\n    });\n\n    this.on('destroy', () => {\n      this._moddle.ids.clear();\n    });\n\n    this.on('viewer.created', ({ viewer }) => {\n\n      viewer.on('elements.changed', ({ elements }) => {\n\n        var viewsChanged = elements.some(function(e) {\n          return isAny(e, [ 'dmn:Decision', 'dmn:Definitions' ]);\n        });\n\n        if (viewsChanged) {\n          this._updateViews();\n        }\n      });\n    });\n  }\n\n  /**\n   * Collect ids processed during parsing of the\n   * definitions object.\n   *\n   * @param {ModdleElement} definitions\n   * @param {Array<ModdleElement>} elementsById\n   */\n  _collectIds(definitions, elementsById) {\n\n    var moddle = definitions.$model,\n        ids = moddle.ids,\n        id;\n\n    // remove references from previous import\n    ids.clear();\n\n    for (id in elementsById) {\n      ids.claim(id, elementsById[id]);\n    }\n  }\n\n  _createModdle(options) {\n    var moddle = super._createModdle(options);\n\n    // attach ids to moddle to be able to track\n    // and validated ids in the DMN XML document\n    // tree\n    moddle.ids = new Ids([ 32, 36, 1 ]);\n\n    return moddle;\n  }\n\n}\n"],"file":"EditingManager.js"}