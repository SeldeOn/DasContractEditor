{"version":3,"sources":["../src/Viewer.js"],"names":["domify","query","domQuery","remove","domRemove","Diagram","inherits","importDRD","innerSVG","wrapForCompatibility","Viewer","options","_container","_createContainer","addProjectLogo","_init","prototype","saveSVG","self","Promise","resolve","canvas","get","contentNode","getDefaultLayer","defsNode","_svg","contents","defs","outerHTML","bbox","getBBox","svg","width","height","x","y","getModules","_modules","destroy","call","on","event","priority","callback","target","off","container","additionalModules","additionalOptions","baseModules","modules","staticModules","drd","diagramOptions","attachTo","_emit","type","fire","open","definitions","reject","err","_definitions","clear","warnings","e","parentNode","Error","detach","appendChild","resized","removeChild","CoreModule","TranslateModule","SelectionModule","OverlaysModule","DefinitionPropertiesModule","DrillDownModule","BPMNIO_IMG","openPoweredBy","domEvent","linkMarkup","linkElement","bind","preventDefault"],"mappings":"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","sourcesContent":["/**\n * The code in the <project-logo></project-logo> area\n * must not be changed.\n *\n * @see http://bpmn.io/license for more information.\n */\n\nimport {\n  domify,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport Diagram from 'diagram-js';\n\nimport inherits from 'inherits';\n\nimport {\n  importDRD\n} from './import/Importer';\n\nimport {\n  innerSVG\n} from 'tiny-svg';\n\nimport {\n  wrapForCompatibility\n} from 'dmn-js-shared/lib/util/CompatibilityUtils';\n\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenResult} OpenResult\n */\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenError} OpenError\n */\n\n\n/**\n * A viewer for DMN diagrams.\n *\n * Have a look at {@link NavigatedViewer} or {@link Modeler} for bundles that include\n * additional features.\n *\n *\n * ## Extending the Viewer\n *\n * In order to extend the viewer pass extension modules to bootstrap via the\n * `additionalModules` option. An extension module is an object that exposes\n * named services.\n *\n * The following example depicts the integration of a simple\n * logging component that integrates with interaction events:\n *\n *\n * ```javascript\n *\n * // logging component\n * function InteractionLogger(eventBus) {\n *   eventBus.on('element.hover', function(event) {\n *     console.log()\n *   })\n * }\n *\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\n *\n * // extension module\n * var extensionModule = {\n *   __init__: [ 'interactionLogger' ],\n *   interactionLogger: [ 'type', InteractionLogger ]\n * };\n *\n * // extend the viewer\n * var drdViewer = new Viewer({ additionalModules: [ extensionModule ] });\n * drdViewer.importXML(...);\n * ```\n *\n * @param {Object} options configuration options to pass to the viewer\n * @param {DOMElement} [options.container]\n *        the container to render the viewer in, defaults to body\n * @param {Array<didi.Module>} [options.modules]\n *        a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules]\n *        a list of modules to use with the default modules\n */\nexport default function Viewer(options) {\n\n  this._container = this._createContainer();\n\n  /* <project-logo> */\n\n  addProjectLogo(this._container);\n\n  /* </project-logo> */\n\n  this._init(this._container, options);\n}\n\ninherits(Viewer, Diagram);\n\n/**\n * The saveSVG result.\n *\n * @typedef {Object} SaveSVGResult\n *\n * @property {string} svg\n */\n\n/**\n * Export the currently displayed DMN diagram as\n * an SVG image.\n *\n * @param {Object} [options]\n *\n * @return {Promise<SaveSVGResult>}\n */\nViewer.prototype.saveSVG = wrapForCompatibility(function(options) {\n  var self = this;\n\n  return new Promise(function(resolve) {\n\n    var canvas = self.get('canvas');\n\n    var contentNode = canvas.getDefaultLayer(),\n        defsNode = domQuery('defs', canvas._svg);\n\n    var contents = innerSVG(contentNode),\n        defs = (defsNode && defsNode.outerHTML) || '';\n\n    var bbox = contentNode.getBBox();\n\n    /* eslint-disable max-len */\n    var svg =\n      '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\n      '<!-- created with dmn-js / http://bpmn.io -->\\n' +\n      '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n           'width=\"' + bbox.width + '\" height=\"' + bbox.height + '\" ' +\n           'viewBox=\"' + bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height + '\" version=\"1.1\">' +\n        defs + contents +\n      '</svg>';\n    /* eslint-enable */\n\n    resolve({ svg });\n  });\n});\n\nViewer.prototype.getModules = function() {\n  return this._modules;\n};\n\n/**\n * Destroy the viewer instance and remove all its\n * remainders from the document tree.\n */\nViewer.prototype.destroy = function() {\n\n  // diagram destroy\n  Diagram.prototype.destroy.call(this);\n\n  // dom detach\n  domRemove(this._container);\n};\n\n/**\n * Register an event listener\n *\n * Remove a previously added listener via {@link #off(event, callback)}.\n *\n * @param {string} event\n * @param {number} [priority]\n * @param {Function} callback\n * @param {Object} [that]\n */\nViewer.prototype.on = function(event, priority, callback, target) {\n  return this.get('eventBus').on(event, priority, callback, target);\n};\n\n/**\n * De-register an event listener\n *\n * @param {string} event\n * @param {Function} callback\n */\nViewer.prototype.off = function(event, callback) {\n  this.get('eventBus').off(event, callback);\n};\n\n\nViewer.prototype._init = function(container, options) {\n\n  var {\n    additionalModules,\n    canvas,\n    ...additionalOptions\n  } = options;\n\n  var baseModules = options.modules || this.getModules(),\n      staticModules = [\n        {\n          drd: [ 'value', this ]\n        }\n      ];\n\n  var modules = [\n    ...staticModules,\n    ...baseModules,\n    ...(additionalModules || [])\n  ];\n\n  var diagramOptions = {\n    ...additionalOptions,\n    canvas: {\n      ...canvas,\n      container\n    },\n    modules\n  };\n\n\n  // invoke diagram constructor\n  Diagram.call(this, diagramOptions);\n\n  if (options && options.container) {\n    this.attachTo(options.container);\n  }\n};\n\n/**\n * Emit an event on the underlying {@link EventBus}\n *\n * @param  {string} type\n * @param  {Object} event\n *\n * @return {Object} event processing result (if any)\n */\nViewer.prototype._emit = function(type, event) {\n  return this.get('eventBus').fire(type, event);\n};\n\nViewer.prototype._createContainer = function() {\n  return domify(\n    '<div class=\"dmn-drd-container\"></div>'\n  );\n};\n\n/**\n * Open diagram element.\n *\n * @param  {ModdleElement} definitions\n * @returns {Promise} Resolves with {OpenResult} when successful\n * or rejects with {OpenError}\n */\nViewer.prototype.open = function(definitions) {\n  var self = this;\n\n  return new Promise((resolve, reject) => {\n    var err;\n\n    // use try/catch to not swallow synchronous exceptions\n    // that may be raised during model parsing\n    try {\n\n      if (self._definitions) {\n\n        // clear existing rendered diagram\n        self.clear();\n      }\n\n      // update definitions\n      self._definitions = definitions;\n\n      // perform graphical import\n      return importDRD(self, definitions, function(err, warnings) {\n        if (err) {\n          err.warnings = warnings || [];\n          reject(err);\n        } else {\n          resolve({ warnings: warnings || [] });\n        }\n      });\n    } catch (e) {\n      err = e;\n    }\n\n    if (err) {\n      err.warnings = err.warnings || [];\n      reject(err);\n    } else {\n      resolve({ warnings: [] });\n    }\n  });\n};\n\n/**\n * Attach viewer to given parent node.\n *\n * @param  {Element} parentNode\n */\nViewer.prototype.attachTo = function(parentNode) {\n\n  if (!parentNode) {\n    throw new Error('parentNode required');\n  }\n\n  // ensure we detach from the\n  // previous, old parent\n  this.detach();\n\n  var container = this._container;\n\n  parentNode.appendChild(container);\n\n  this._emit('attach', {});\n\n  this.get('canvas').resized();\n};\n\n/**\n * Detach viewer from parent node, if attached.\n */\nViewer.prototype.detach = function() {\n\n  var container = this._container,\n      parentNode = container.parentNode;\n\n  if (!parentNode) {\n    return;\n  }\n\n  this._emit('detach', {});\n\n  parentNode.removeChild(container);\n};\n\nimport CoreModule from './core';\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport OverlaysModule from 'diagram-js/lib/features/overlays';\nimport DefinitionPropertiesModule from './features/definition-properties/viewer';\nimport DrillDownModule from './features/drill-down';\n\nViewer.prototype._modules = [\n  CoreModule,\n  TranslateModule,\n  SelectionModule,\n  OverlaysModule,\n  DefinitionPropertiesModule,\n  DrillDownModule\n];\n\n/* <project-logo> */\n\nimport {\n  BPMNIO_IMG,\n  open as openPoweredBy\n} from './util/PoweredByUtil';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\n/**\n * Adds the project logo to the diagram container as\n * required by the bpmn.io license.\n *\n * @see http://bpmn.io/license\n *\n * @param {Element} container\n */\nfunction addProjectLogo(container) {\n  var linkMarkup =\n    '<a href=\"http://bpmn.io\" ' +\n       'target=\"_blank\" ' +\n       'class=\"bjs-powered-by\" ' +\n       'title=\"Powered by bpmn.io\" ' +\n       'style=\"position: absolute; bottom: 15px; right: 15px; z-index: 100;\">' +\n      BPMNIO_IMG +\n    '</a>';\n\n  var linkElement = domify(linkMarkup);\n\n  container.appendChild(linkElement);\n\n  domEvent.bind(linkElement, 'click', function(event) {\n    openPoweredBy();\n\n    event.preventDefault();\n  });\n}\n\n/* </project-logo> */\n"],"file":"Viewer.js"}