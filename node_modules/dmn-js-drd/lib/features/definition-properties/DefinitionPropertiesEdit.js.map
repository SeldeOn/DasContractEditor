{"version":3,"sources":["../../../src/features/definition-properties/DefinitionPropertiesEdit.js"],"names":["debounce","DEBOUNCE_DELAY","domify","classes","domClasses","query","domQuery","getBusinessObject","validateId","DefinitionIdEdit","eventBus","modeling","canvas","definitionPropertiesView","_eventBus","_modeling","_canvas","_definitionPropertiesView","on","event","_container","html","nameElement","idElement","_setup","$inject","prototype","update","type","newValue","element","getRootElement","newProperties","errorMessage","_addErrorMessage","_clearErrorMessage","updateProperties","node","self","setAttribute","addEventListener","evt","value","target","textContent","trim","keyCode","blur","window","getSelection","removeAllRanges","errorHTML","add","parentElement","appendChild","has","remove","errorLabel","parentNode","removeChild"],"mappings":"AAAA,SACEA,QADF,QAEO,UAFP;AAIA,IAAIC,cAAc,GAAG,GAArB;AAEA,SACEC,MADF,EAEEC,OAAO,IAAIC,UAFb,EAGEC,KAAK,IAAIC,QAHX,QAIO,SAJP;AAMA,SACEC,iBADF,QAEO,kCAFP;AAIA,SACEC,UADF,QAEO,gCAFP;AAKA,eAAe,SAASC,gBAAT,CACXC,QADW,EACDC,QADC,EACSC,MADT,EACiBC,wBADjB,EAC2C;AACxD,OAAKC,SAAL,GAAiBJ,QAAjB;AACA,OAAKK,SAAL,GAAiBJ,QAAjB;AACA,OAAKK,OAAL,GAAeJ,MAAf;AACA,OAAKK,yBAAL,GAAiCJ,wBAAjC;AAEAH,EAAAA,QAAQ,CAACQ,EAAT,CAAY,yBAAZ,EAAuC,UAASC,KAAT,EAAgB;AACrD,SAAKC,UAAL,GAAkBD,KAAK,CAACE,IAAxB;AACA,QAAIC,WAAW,GAAGhB,QAAQ,CAAC,uBAAD,EAA0B,KAAKc,UAA/B,CAA1B;AAAA,QACIG,SAAS,GAAGjB,QAAQ,CAAC,qBAAD,EAAwB,KAAKc,UAA7B,CADxB;;AAGA,SAAKI,MAAL,CAAYF,WAAZ,EAAyB,MAAzB;;AACA,SAAKE,MAAL,CAAYD,SAAZ,EAAuB,IAAvB;AACD,GAPD,EAOG,IAPH;AAQD;AAEDd,gBAAgB,CAACgB,OAAjB,GAA2B,CACzB,UADyB,EAEzB,UAFyB,EAGzB,QAHyB,EAIzB,0BAJyB,CAA3B;;AAQAhB,gBAAgB,CAACiB,SAAjB,CAA2BC,MAA3B,GAAoC,UAASC,IAAT,EAAeC,QAAf,EAAyB;AAC3D,MAAIC,OAAO,GAAG,KAAKd,OAAL,CAAae,cAAb,EAAd;;AACA,MAAIC,aAAa,GAAG,EAApB;AACAA,EAAAA,aAAa,CAACJ,IAAD,CAAb,GAAsBC,QAAtB;;AAEA,MAAID,IAAI,KAAK,IAAb,EAAmB;AACjB,QAAIK,YAAY,GAAGzB,UAAU,CAACD,iBAAiB,CAACuB,OAAD,CAAlB,EAA6BD,QAA7B,CAA7B;;AAEA,QAAII,YAAJ,EAAkB;AAChB,WAAKC,gBAAL,CAAsBD,YAAtB;;AAEA;AACD;;AAED,SAAKE,kBAAL;AACD;;AAED,OAAKpB,SAAL,CAAeqB,gBAAf,CAAgCN,OAAhC,EAAyCE,aAAzC;AACD,CAlBD;;AAoBAvB,gBAAgB,CAACiB,SAAjB,CAA2BF,MAA3B,GAAoC,UAASa,IAAT,EAAeT,IAAf,EAAqB;AACvD,MAAIU,IAAI,GAAG,IAAX;AAEAD,EAAAA,IAAI,CAACE,YAAL,CAAkB,iBAAlB,EAAqC,IAArC;AAEAF,EAAAA,IAAI,CAACG,gBAAL,CAAsB,OAAtB,EAA+BxC,QAAQ,CAAC,UAASyC,GAAT,EAAc;AACpD,QAAIC,KAAK,GAAGD,GAAG,CAACE,MAAJ,CAAWD,KAAX,IAAoBD,GAAG,CAACE,MAAJ,CAAWC,WAA3C;AAEAN,IAAAA,IAAI,CAACX,MAAL,CAAYC,IAAZ,EAAkBc,KAAK,CAACG,IAAN,EAAlB;AACD,GAJsC,EAIpC5C,cAJoC,CAAvC;AAMAoC,EAAAA,IAAI,CAACG,gBAAL,CAAsB,SAAtB,EAAiC,UAASC,GAAT,EAAc;AAC7C,QAAIA,GAAG,CAACK,OAAJ,KAAgB,EAApB,EAAwB;AACtBT,MAAAA,IAAI,CAACU,IAAL;AACAC,MAAAA,MAAM,CAACC,YAAP,GAAsBC,eAAtB;AACD;AACF,GALD;AAOAb,EAAAA,IAAI,CAACG,gBAAL,CAAsB,MAAtB,EAA8B,YAAW;AACvCF,IAAAA,IAAI,CAACH,kBAAL;;AAEAG,IAAAA,IAAI,CAACrB,yBAAL,CAA+BU,MAA/B;AACD,GAJD;AAKD,CAvBD;;AAyBAlB,gBAAgB,CAACiB,SAAjB,CAA2BQ,gBAA3B,GAA8C,UAASD,YAAT,EAAuB;AACnE,MAAMkB,SAAS,GACb,iDACAlB,YADA,GAEA,SAHF;AAKA,MAAIV,SAAS,GAAGjB,QAAQ,CAAC,qBAAD,EAAwB,KAAKc,UAA7B,CAAxB,CANmE,CAQnE;;AACA,OAAKe,kBAAL,GATmE,CAWnE;;;AACA/B,EAAAA,UAAU,CAACmB,SAAD,CAAV,CAAsB6B,GAAtB,CAA0B,uBAA1B;AACA7B,EAAAA,SAAS,CAAC8B,aAAV,CAAwBC,WAAxB,CAAoCpD,MAAM,CAACiD,SAAD,CAA1C;AACD,CAdD;;AAgBA1C,gBAAgB,CAACiB,SAAjB,CAA2BS,kBAA3B,GAAgD,YAAW;AACzD,MAAIZ,SAAS,GAAGjB,QAAQ,CAAC,qBAAD,EAAwB,KAAKc,UAA7B,CAAxB;;AAEA,MAAIhB,UAAU,CAACmB,SAAD,CAAV,CAAsBgC,GAAtB,CAA0B,uBAA1B,CAAJ,EAAwD;AACtDnD,IAAAA,UAAU,CAACmB,SAAD,CAAV,CAAsBiC,MAAtB,CAA6B,uBAA7B;AAEA,QAAMC,UAAU,GAAGnD,QAAQ,CAAC,gCAAD,EAAmC,KAAKc,UAAxC,CAA3B;AACAG,IAAAA,SAAS,CAACmC,UAAV,CAAqBC,WAArB,CAAiCF,UAAjC;AACD;AACF,CATD","sourcesContent":["import {\n  debounce\n} from 'min-dash';\n\nvar DEBOUNCE_DELAY = 300;\n\nimport {\n  domify,\n  classes as domClasses,\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  getBusinessObject\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport {\n  validateId\n} from 'dmn-js-shared/lib/util/IdsUtil';\n\n\nexport default function DefinitionIdEdit(\n    eventBus, modeling, canvas, definitionPropertiesView) {\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._canvas = canvas;\n  this._definitionPropertiesView = definitionPropertiesView;\n\n  eventBus.on('definitionIdView.create', function(event) {\n    this._container = event.html;\n    var nameElement = domQuery('.dmn-definitions-name', this._container),\n        idElement = domQuery('.dmn-definitions-id', this._container);\n\n    this._setup(nameElement, 'name');\n    this._setup(idElement, 'id');\n  }, this);\n}\n\nDefinitionIdEdit.$inject = [\n  'eventBus',\n  'modeling',\n  'canvas',\n  'definitionPropertiesView'\n];\n\n\nDefinitionIdEdit.prototype.update = function(type, newValue) {\n  var element = this._canvas.getRootElement();\n  var newProperties = {};\n  newProperties[type] = newValue;\n\n  if (type === 'id') {\n    var errorMessage = validateId(getBusinessObject(element), newValue);\n\n    if (errorMessage) {\n      this._addErrorMessage(errorMessage);\n\n      return;\n    }\n\n    this._clearErrorMessage();\n  }\n\n  this._modeling.updateProperties(element, newProperties);\n};\n\nDefinitionIdEdit.prototype._setup = function(node, type) {\n  var self = this;\n\n  node.setAttribute('contenteditable', true);\n\n  node.addEventListener('input', debounce(function(evt) {\n    var value = evt.target.value || evt.target.textContent;\n\n    self.update(type, value.trim());\n  }, DEBOUNCE_DELAY));\n\n  node.addEventListener('keydown', function(evt) {\n    if (evt.keyCode === 13) {\n      node.blur();\n      window.getSelection().removeAllRanges();\n    }\n  });\n\n  node.addEventListener('blur', function() {\n    self._clearErrorMessage();\n\n    self._definitionPropertiesView.update();\n  });\n};\n\nDefinitionIdEdit.prototype._addErrorMessage = function(errorMessage) {\n  const errorHTML =\n    '<span class=\"dmn-definitions-error-message\">' +\n    errorMessage +\n    '</span>';\n\n  var idElement = domQuery('.dmn-definitions-id', this._container);\n\n  // clear previous error message\n  this._clearErrorMessage();\n\n  // add current error message\n  domClasses(idElement).add('dmn-definitions-error');\n  idElement.parentElement.appendChild(domify(errorHTML));\n};\n\nDefinitionIdEdit.prototype._clearErrorMessage = function() {\n  var idElement = domQuery('.dmn-definitions-id', this._container);\n\n  if (domClasses(idElement).has('dmn-definitions-error')) {\n    domClasses(idElement).remove('dmn-definitions-error');\n\n    const errorLabel = domQuery('.dmn-definitions-error-message', this._container);\n    idElement.parentNode.removeChild(errorLabel);\n  }\n};\n"],"file":"DefinitionPropertiesEdit.js"}