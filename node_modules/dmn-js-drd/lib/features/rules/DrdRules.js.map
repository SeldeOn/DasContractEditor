{"version":3,"sources":["../../../src/features/rules/DrdRules.js"],"names":["is","isAny","inherits","RuleProvider","every","isArray","DrdRules","injector","invoke","$inject","prototype","init","addRule","context","source","target","canConnect","connection","type","businessObject","shapes","position","canMove","shape","canCreate","isLabel","elements","element","labelTarget"],"mappings":"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","sourcesContent":["import {\n  is,\n  isAny\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport inherits from 'inherits';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\n\nimport {\n  every,\n  isArray\n} from 'min-dash';\n\n\n/**\n * DRD modeling rules.\n */\nexport default function DrdRules(injector) {\n  injector.invoke(RuleProvider, this);\n}\n\ninherits(DrdRules, RuleProvider);\n\nDrdRules.$inject = [ 'injector' ];\n\nDrdRules.prototype.init = function() {\n\n  this.addRule('connection.create', function(context) {\n    var source = context.source,\n        target = context.target;\n\n    return canConnect(source, target);\n  });\n\n  this.addRule('connection.reconnect', function(context) {\n    var connection = context.connection,\n        source = context.source,\n        target = context.target;\n\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule('connection.updateWaypoints', function(context) {\n    const connection = context.connection;\n\n    return {\n      type: connection.type,\n      businessObject: connection.businessObject\n    };\n  });\n\n  this.addRule('elements.move', function(context) {\n    var target = context.target,\n        shapes = context.shapes,\n        position = context.position;\n\n    return canMove(shapes, target, position);\n  });\n\n  this.addRule('shape.create', function(context) {\n    var shape = context.shape,\n        target = context.target;\n\n    return canCreate(shape, target);\n  });\n\n  this.addRule('shape.resize', function(context) {\n    var shape = context.shape;\n\n    return is(shape, 'dmn:TextAnnotation');\n  });\n\n};\n\nDrdRules.prototype.canConnect = canConnect;\n\nDrdRules.prototype.canCreate = canCreate;\n\nDrdRules.prototype.canMove = canMove;\n\n\nfunction canConnect(source, target) {\n  if (!source || isLabel(source) || !target || isLabel(target)) {\n    return null;\n  }\n\n  if (source === target) {\n    return false;\n  }\n\n  if (is(source, 'dmn:BusinessKnowledgeModel') &&\n      isAny(target, [\n        'dmn:BusinessKnowledgeModel',\n        'dmn:Decision'\n      ])) {\n    return { type: 'dmn:KnowledgeRequirement' };\n  }\n\n  if (is(source, 'dmn:Decision')) {\n\n    if (is(target, 'dmn:Decision')) {\n      return { type: 'dmn:InformationRequirement' };\n    }\n\n    if (is(target, 'dmn:KnowledgeSource')) {\n      return { type: 'dmn:AuthorityRequirement' };\n    }\n\n  }\n\n  if (is(source, 'dmn:Definitions') || is(target, 'dmn:Definitions')) {\n    return false;\n  }\n\n  if (is(source, 'dmn:InputData')) {\n\n    if (is(target, 'dmn:Decision')) {\n      return { type: 'dmn:InformationRequirement' };\n    }\n\n    if (is(target, 'dmn:KnowledgeSource')) {\n      return { type: 'dmn:AuthorityRequirement' };\n    }\n\n  }\n\n  if (is(source, 'dmn:KnowledgeSource') &&\n      isAny(target, [\n        'dmn:BusinessKnowledgeModel',\n        'dmn:Decision',\n        'dmn:KnowledgeSource'\n      ])) {\n    return { type: 'dmn:AuthorityRequirement' };\n  }\n\n  if ((is(source, 'dmn:TextAnnotation') && !is(target, 'dmn:TextAnnotation'))\n  || (!is(source, 'dmn:TextAnnotation') && is(target, 'dmn:TextAnnotation'))) {\n    return { type: 'dmn:Association' };\n  }\n\n  return false;\n}\n\nfunction canCreate(shape, target) {\n  return isAny(shape, [\n    'dmn:BusinessKnowledgeModel',\n    'dmn:Decision',\n    'dmn:InputData',\n    'dmn:KnowledgeSource',\n    'dmn:TextAnnotation'\n  ]) && is(target, 'dmn:Definitions');\n}\n\nfunction canMove(elements, target) {\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  // allow default move check to start move operation\n  if (!target) {\n    return true;\n  }\n\n  if (every(elements, function(element) {\n    return isAny(element, [\n      'dmn:BusinessKnowledgeModel',\n      'dmn:Decision',\n      'dmn:InputData',\n      'dmn:KnowledgeSource',\n      'dmn:TextAnnotation',\n      'dmn:InformationRequirement',\n      'dmn:AuthorityRequirement',\n      'dmn:KnowledgeRequirement',\n      'dmn:Association'\n    ]);\n  }) && is(target, 'dmn:Definitions')) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function isLabel(element) {\n  return !!element.labelTarget;\n}"],"file":"DrdRules.js"}