{"version":3,"sources":["../../../src/features/snapping/DrdBendpointSnapping.js"],"names":["asTRBL","getMid","getOrientation","isAny","RECONNECT_START","RECONNECT_END","HIGH_PRIORITY","DrdBendpointSnapping","eventBus","on","event","context","allowed","hover","source","target","type","hints","connectionStart","connectionEnd","reconnect","orientation","snapToSource","getConnectionEnd","getConnectionStart","snapToTarget","$inject","sourceTrbl","includes","y","top","bottom","x","left","right","targetTrbl","dx","dy"],"mappings":"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","sourcesContent":["import {\r\n  asTRBL,\r\n  getMid,\r\n  getOrientation\r\n} from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\nimport {\r\n  isAny\r\n} from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nvar RECONNECT_START = 'reconnectStart',\r\n    RECONNECT_END = 'reconnectEnd';\r\n\r\nvar HIGH_PRIORITY = 2000;\r\n\r\n\r\nexport default function DrdBendpointSnapping(eventBus) {\r\n  eventBus.on([\r\n    'bendpoint.move.move',\r\n    'bendpoint.move.end'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        allowed = context.allowed,\r\n        hover = context.hover,\r\n        source = context.source,\r\n        target = context.target,\r\n        type = context.type;\r\n\r\n    if (!context.hints) {\r\n      context.hints = {};\r\n    }\r\n\r\n    delete context.hints.connectionStart;\r\n    delete context.hints.connectionEnd;\r\n\r\n    if (allowed && allowed.type !== 'dmn:InformationRequirement') {\r\n      return;\r\n    }\r\n\r\n    if (!hover || !isAny(hover, [ 'dmn:Decision', 'dmn:InputData' ])) {\r\n      return;\r\n    }\r\n\r\n    if (source === target) {\r\n      return;\r\n    }\r\n\r\n    var reconnect = type === RECONNECT_START || type === RECONNECT_END;\r\n\r\n    var orientation = getOrientation(source, target);\r\n\r\n    if (reconnect && hover === source) {\r\n\r\n      // (1) snap event to source\r\n      snapToSource(event, orientation);\r\n\r\n      // (2) set connection end to target\r\n      context.hints.connectionEnd = getConnectionEnd(target, orientation);\r\n    } else if (reconnect && hover === target) {\r\n\r\n      // (1) set connection start to source\r\n      context.hints.connectionStart = getConnectionStart(source, orientation);\r\n\r\n      // (2) snap event to target\r\n      snapToTarget(event, orientation);\r\n    }\r\n  });\r\n}\r\n\r\nDrdBendpointSnapping.$inject = [ 'eventBus' ];\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction getConnectionStart(source, orientation) {\r\n  var sourceTrbl = asTRBL(source);\r\n\r\n  var connectionStart = getMid(source);\r\n\r\n  if (orientation.includes('bottom')) {\r\n    connectionStart.y = sourceTrbl.top;\r\n  } else if (orientation.includes('top')) {\r\n    connectionStart.y = sourceTrbl.bottom;\r\n  } else if (orientation.includes('right')) {\r\n    connectionStart.x = sourceTrbl.left;\r\n  } else {\r\n    connectionStart.x = sourceTrbl.right;\r\n  }\r\n\r\n  return connectionStart;\r\n}\r\n\r\nfunction getConnectionEnd(target, orientation) {\r\n  var targetTrbl = asTRBL(target);\r\n\r\n  var connectionEnd = getMid(target);\r\n\r\n  if (orientation.includes('bottom')) {\r\n    connectionEnd.y = targetTrbl.bottom;\r\n  } else if (orientation.includes('top')) {\r\n    connectionEnd.y = targetTrbl.top;\r\n  } else if (orientation.includes('right')) {\r\n    connectionEnd.x = targetTrbl.right;\r\n  } else {\r\n    connectionEnd.x = targetTrbl.left;\r\n  }\r\n\r\n  return connectionEnd;\r\n}\r\n\r\nfunction snapToSource(event, orientation) {\r\n  var context = event.context,\r\n      source = context.source;\r\n\r\n  var connectionStart = getConnectionStart(source, orientation);\r\n\r\n  var dx = event.x - connectionStart.x,\r\n      dy = event.y - connectionStart.y;\r\n\r\n  event.x -= dx;\r\n  event.y -= dy;\r\n\r\n  event.dx -= dx;\r\n  event.dy -= dy;\r\n}\r\n\r\nfunction snapToTarget(event, orientation) {\r\n  var context = event.context,\r\n      target = context.target;\r\n\r\n  var connectionEnd = getConnectionEnd(target, orientation);\r\n\r\n  var dx = 0,\r\n      dy = 0;\r\n\r\n  if (orientation.includes('top') ||orientation.includes('bottom')) {\r\n    dy = event.y - connectionEnd.y;\r\n  } else {\r\n    dx = event.x - connectionEnd.x;\r\n  }\r\n\r\n  event.x -= dx;\r\n  event.y -= dy;\r\n\r\n  event.dx -= dx;\r\n  event.dy -= dy;\r\n}"],"file":"DrdBendpointSnapping.js"}