{"version":3,"sources":["../../../../src/features/context-menu/components/ContextMenuComponent.js"],"names":["Component","assign","isFunction","inject","closest","domClosest","query","domQuery","setRange","DEFAULT_STYLE","position","ContextMenuComponent","props","context","close","setState","isOpen","x","y","state","undefined","eventBus","fire","on","open","off","components","getComponents","length","offset","autoFocus","autoClose","triggerClose","$inject","ContextMenu","event","checkClose","target","keyCode","which","stopPropagation","preventDefault","node","updatePosition","ensureFocus","onClose","focusTarget","contains","document","addEventListener","onFocusChanged","onGlobalKey","onGlobalMouseDown","removeEventListener","bounds","getBoundingClientRect","width","height","container","renderer","getContainer","containerBounds","classList","add","remove","getTableContainerScroll","scrollLeft","scrollTop","style","alignment","align","split","left","top","horizontalAlignment","clampNumber","verticalAlignment","overflowY","maxHeight","className","map","idx","e","setNode","number","min","max","Math","SELECTABLE_ELEMENTS","el","focusEl","focus","selectionStart","type","start","end","tableContainer"],"mappings":"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","sourcesContent":["import { Component } from 'inferno';\r\n\r\nimport {\r\n  assign,\r\n  isFunction\r\n} from 'min-dash';\r\n\r\nimport {\r\n  inject\r\n} from '../../../components';\r\n\r\nimport {\r\n  closest as domClosest,\r\n  query as domQuery\r\n} from 'min-dom';\r\n\r\nimport {\r\n  setRange\r\n} from 'selection-ranges';\r\n\r\nconst DEFAULT_STYLE = {\r\n  position: 'absolute'\r\n};\r\n\r\n/**\r\n * @typedef ContextMenuPosition\r\n * @property {number} x\r\n * @property {number} y\r\n * @property {number} [width=0]\r\n * @property {number} [height=0]\r\n * @property {'bottom-left'|'bottom-right'|'top-left'|'top-right'} [align]\r\n */\r\n\r\nexport default class ContextMenuComponent extends Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    this.state = {\r\n      isOpen: false,\r\n      position: {\r\n        x: 0,\r\n        y: 0\r\n      }\r\n    };\r\n\r\n    inject(this);\r\n  }\r\n\r\n  /**\r\n   * Open the context menu with given position and context.\r\n   *\r\n   * The menu itself will figure out the best position, taking the optional\r\n   * positioning parameter into account. Position can also contain indicator\r\n   * in which direction to open context menu.\r\n   *\r\n   * @param {ContextMenuPosition} position\r\n   * @param {Object} [context]\r\n   */\r\n  open = ({ position, context }) => {\r\n\r\n    // always close first\r\n    this.close();\r\n\r\n    this.setState({\r\n      isOpen: true,\r\n      position: position || { x: 0, y: 0 },\r\n      context: context || {}\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Closes context menu and resets state.\r\n   */\r\n  close = () => {\r\n\r\n    if (this.state.isOpen) {\r\n      this.setState({\r\n        context: undefined,\r\n        isOpen: false,\r\n        position: {\r\n          x: 0,\r\n          y: 0\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  triggerClose = () => {\r\n    this.eventBus.fire('contextMenu.close');\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.eventBus.on('contextMenu.open', this.open);\r\n    this.eventBus.on('contextMenu.close', this.close);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.eventBus.off('contextMenu.open', this.open);\r\n    this.eventBus.off('contextMenu.close', this.close);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      isOpen,\r\n      context,\r\n      position\r\n    } = this.state;\r\n\r\n    if (!isOpen) {\r\n      return null;\r\n    }\r\n\r\n    const components = this.components.getComponents('context-menu', context);\r\n\r\n    if (!components.length) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <ContextMenu\r\n        className=\"context-menu no-deselect\"\r\n        context={ context }\r\n        position={ position }\r\n        offset={ context.offset || { x: 0, y: 0 } }\r\n        autoFocus={ context.autoFocus !== false }\r\n        autoClose={ context.autoClose !== false }\r\n        components={ components }\r\n        onClose={ this.triggerClose } />\r\n    );\r\n  }\r\n}\r\n\r\nContextMenuComponent.$inject = [\r\n  'eventBus',\r\n  'components'\r\n];\r\n\r\n\r\n/**\r\n * Low-level, stateless context menu holder.\r\n */\r\nclass ContextMenu extends Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    inject(this);\r\n  }\r\n\r\n  close() {\r\n\r\n    const {\r\n      onClose\r\n    } = this.props;\r\n\r\n    if (isFunction(onClose)) {\r\n      onClose();\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Check whether closing the context menu is necessary\r\n   * after selecting the given element.\r\n   */\r\n  checkClose(focusTarget) {\r\n\r\n    const {\r\n      autoClose\r\n    } = this.props;\r\n\r\n    if (!autoClose) {\r\n      return;\r\n    }\r\n\r\n    var node = this.node;\r\n\r\n    if (!node) {\r\n      return;\r\n    }\r\n\r\n    if (node === focusTarget) {\r\n      return;\r\n    }\r\n\r\n    if (node.contains(focusTarget)) {\r\n      return;\r\n    }\r\n\r\n    this.close();\r\n  }\r\n\r\n  /**\r\n   * Handle global (window) mousedown event.\r\n   */\r\n  onGlobalMouseDown = (event) => {\r\n    this.checkClose(event.target);\r\n  }\r\n\r\n  /**\r\n   * Handle global key event.\r\n   */\r\n  onGlobalKey = (event) => {\r\n\r\n    var keyCode = event.which;\r\n\r\n    // ENTER or ESC\r\n    if (keyCode === 13 || keyCode === 27) {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      this.close();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle global (document) focus changed event.\r\n   */\r\n  onFocusChanged = (event) => {\r\n    this.checkClose(event.target);\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('focusin', this.onFocusChanged);\r\n    document.addEventListener('keydown', this.onGlobalKey);\r\n    document.addEventListener('mousedown', this.onGlobalMouseDown);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('focusin', this.onFocusChanged);\r\n    document.removeEventListener('keydown', this.onGlobalKey);\r\n    document.removeEventListener('mousedown', this.onGlobalMouseDown);\r\n  }\r\n\r\n  setNode = (node) => {\r\n    this.node = node;\r\n\r\n    const {\r\n      autoFocus\r\n    } = this.props;\r\n\r\n    if (node) {\r\n      this.updatePosition();\r\n\r\n      if (autoFocus) {\r\n        ensureFocus(node);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find best context menu position and re-layout accordingly.\r\n   */\r\n  updatePosition() {\r\n    const {\r\n      position,\r\n      offset\r\n    } = this.props;\r\n\r\n    const { node } = this;\r\n\r\n    const bounds = node.getBoundingClientRect();\r\n\r\n    if (!position.width) {\r\n      position.width = 0;\r\n    }\r\n\r\n    if (!position.height) {\r\n      position.height = 0;\r\n    }\r\n\r\n    const container = this.renderer.getContainer(),\r\n          containerBounds = container.getBoundingClientRect();\r\n\r\n    if (containerBounds.width > containerBounds.height) {\r\n      this.node.classList.add('horizontal');\r\n      this.node.classList.remove('vertical');\r\n    } else {\r\n      this.node.classList.add('vertical');\r\n      this.node.classList.remove('horizontal');\r\n    }\r\n\r\n    const { scrollLeft, scrollTop } = getTableContainerScroll(node);\r\n\r\n    const style = {};\r\n\r\n    let alignment;\r\n\r\n    if (position.align) {\r\n      alignment = position.align.split('-');\r\n    }\r\n\r\n    let left, top;\r\n\r\n    const horizontalAlignment = alignment && alignment[1] || (\r\n      position.x + (position.width / 2) > containerBounds.width / 2\r\n        ? 'left'\r\n        : 'right'\r\n    );\r\n\r\n    if (horizontalAlignment === 'left') {\r\n      left = position.x\r\n        - containerBounds.left\r\n        - bounds.width\r\n        + offset.x\r\n        + scrollLeft;\r\n\r\n      node.classList.remove('right');\r\n      node.classList.add('left');\r\n    } else {\r\n      left = -containerBounds.left\r\n        + position.x\r\n        + position.width\r\n        - offset.x\r\n        + scrollLeft;\r\n\r\n      node.classList.remove('left');\r\n      node.classList.add('right');\r\n    }\r\n    left = alignment ? left : clampNumber(\r\n      left,\r\n      0 + scrollLeft,\r\n      containerBounds.width - bounds.width + scrollLeft\r\n    );\r\n    style.left = left + 'px';\r\n\r\n    const verticalAlignment = alignment && alignment[0] || (\r\n      position.y + (position.height / 2) > containerBounds.height / 2\r\n        ? 'top'\r\n        : 'bottom'\r\n    );\r\n\r\n    if (verticalAlignment === 'top') {\r\n      top = position.y\r\n        - containerBounds.top\r\n        - bounds.height\r\n        + offset.y\r\n        + scrollTop;\r\n\r\n      node.classList.remove('bottom');\r\n      node.classList.add('top');\r\n    } else {\r\n      top = -containerBounds.top\r\n        + position.y\r\n        - offset.y\r\n        + scrollTop;\r\n\r\n      node.classList.remove('top');\r\n      node.classList.add('bottom');\r\n    }\r\n    top = alignment ? top : clampNumber(\r\n      top,\r\n      0 + scrollTop,\r\n      containerBounds.height - bounds.height + scrollTop\r\n    );\r\n    style.top = top + 'px';\r\n\r\n    // ensure context menu will always be accessible\r\n    style.overflowY = 'auto';\r\n    style.maxHeight = (containerBounds.height - top + scrollTop) + 'px';\r\n\r\n    assign(this.node.style, DEFAULT_STYLE, style);\r\n  }\r\n\r\n\r\n  render() {\r\n\r\n    const {\r\n      context,\r\n      components,\r\n      className\r\n    } = this.props;\r\n\r\n    return (\r\n      <div\r\n        ref={ this.setNode }\r\n        onContextMenu={ e => e.preventDefault() }\r\n        className={ className }>\r\n        {\r\n          components.map(\r\n            (Component, idx) => <Component key={ idx } context={ context } />\r\n          )\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nContextMenu.$inject = [\r\n  'renderer'\r\n];\r\n\r\n\r\n// helpers /////////////\r\n\r\nfunction clampNumber(number, min, max) {\r\n  return Math.max(min, Math.min(max, number));\r\n}\r\n\r\nconst SELECTABLE_ELEMENTS = `\r\n  input[type=text],\r\n  input[type=number],\r\n  input[type=button],\r\n  input[type=submit],\r\n  [contenteditable],\r\n  [tabindex],\r\n  a[href],\r\n  textarea,\r\n  button\r\n`;\r\n\r\nfunction ensureFocus(el) {\r\n\r\n  var focusEl = domQuery(SELECTABLE_ELEMENTS, el);\r\n\r\n  if (focusEl) {\r\n    focusEl.focus();\r\n\r\n    // inputs\r\n    if (focusEl.selectionStart && focusEl.type === 'text') {\r\n      focusEl.selectionStart = 100000;\r\n    } else\r\n\r\n    // content editable elements\r\n    if ('contentEditable' in focusEl) {\r\n      setRange(focusEl, { start: 100000, end: 100000 });\r\n    }\r\n  }\r\n}\r\n\r\nfunction getTableContainerScroll(node) {\r\n  const tableContainer = domClosest(node, '.tjs-container');\r\n\r\n  if (!tableContainer) {\r\n    return {\r\n      scrollTop: 0,\r\n      scrollLeft: 0\r\n    };\r\n  }\r\n\r\n  const { scrollLeft, scrollTop } = tableContainer;\r\n\r\n  return {\r\n    scrollTop,\r\n    scrollLeft\r\n  };\r\n}"],"file":"ContextMenuComponent.js"}