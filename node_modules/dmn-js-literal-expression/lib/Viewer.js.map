{"version":3,"sources":["../src/Viewer.js"],"names":["BaseViewer","assign","domify","remove","domRemove","CoreModule","DecisionPropertiesModule","LiteralExpressionPropertiesModule","PoweredByModule","TextareaModule","ViewDrdModule","Viewer","options","container","_createContainer","renderer","_container","decision","self","Promise","resolve","reject","err","_decision","clear","get","fire","e","warnings","modules","additionalModules","config","baseModules","getModules","extraModules","staticModules","viewer","allModules","event","priority","callback","target","on","off","type","parentNode","Error","detach","appendChild","_emit","_getModules"],"mappings":"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","sourcesContent":["import BaseViewer from 'dmn-js-shared/lib/base/viewer/Viewer';\r\n\r\nimport {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  domify,\r\n  remove as domRemove\r\n} from 'min-dom';\r\n\r\nimport CoreModule from './core';\r\nimport DecisionPropertiesModule from './features/decision-properties';\r\nimport LiteralExpressionPropertiesModule from './features/literal-expression-properties';\r\nimport PoweredByModule from './features/powered-by';\r\nimport TextareaModule from './features/textarea';\r\nimport ViewDrdModule from './features/view-drd';\r\n\r\n/**\r\n * @typedef {import('dmn-js-shared/lib/base/View).OpenResult} OpenResult\r\n */\r\n\r\n/**\r\n * @typedef {import('dmn-js-shared/lib/base/View).OpenError} OpenError\r\n */\r\n\r\n\r\nexport default class Viewer extends BaseViewer {\r\n\r\n  constructor(options = {}) {\r\n    const container = Viewer._createContainer();\r\n\r\n    super(assign(options, {\r\n      renderer: {\r\n        container\r\n      }\r\n    }));\r\n\r\n    this._container = container;\r\n  }\r\n\r\n  /**\r\n   * Open diagram element.\r\n   *\r\n   * @param  {ModdleElement} decision\r\n   * @returns {Promise} Resolves with {OpenResult} when successful\r\n   * or rejects with {OpenError}\r\n   */\r\n  open(decision) {\r\n    var self = this;\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      var err;\r\n\r\n      // use try/catch to not swallow synchronous exceptions\r\n      // that may be raised during model parsing\r\n      try {\r\n\r\n        if (self._decision) {\r\n\r\n          // clear existing literal expression\r\n          self.clear();\r\n\r\n          // unmount first\r\n          self.get('eventBus').fire('renderer.unmount');\r\n        }\r\n\r\n        // update literal expression\r\n        self._decision = decision;\r\n\r\n        // let others know about import\r\n        self.get('eventBus').fire('import', decision);\r\n\r\n        self.get('eventBus').fire('renderer.mount');\r\n      } catch (e) {\r\n        err = e;\r\n      }\r\n\r\n      // handle synchronously thrown exception\r\n      if (err) {\r\n        err.warnings = err.warnings || [];\r\n        reject(err);\r\n      } else {\r\n        resolve({ warnings: [] });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the literal expression, returning { modules: [], config }.\r\n   *\r\n   * @param  {Object} options\r\n   *\r\n   * @return {Object} init config\r\n   */\r\n  _init(options) {\r\n\r\n    let {\r\n      modules,\r\n      additionalModules,\r\n      ...config\r\n    } = options;\r\n\r\n    let baseModules = modules || this.getModules();\r\n    let extraModules = additionalModules || [];\r\n    let staticModules = [\r\n      {\r\n        viewer: [ 'value', this ]\r\n      }\r\n    ];\r\n\r\n    let allModules = [\r\n      ...baseModules,\r\n      ...extraModules,\r\n      ...staticModules\r\n    ];\r\n\r\n    return {\r\n      modules: allModules,\r\n      config\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Register an event listener\r\n   *\r\n   * Remove a previously added listener via {@link #off(event, callback)}.\r\n   *\r\n   * @param {string} event\r\n   * @param {number} [priority]\r\n   * @param {Function} callback\r\n   * @param {Object} [that]\r\n   */\r\n  on(event, priority, callback, target) {\r\n    return this.get('eventBus').on(event, priority, callback, target);\r\n  }\r\n\r\n  /**\r\n   * De-register an event listener\r\n   *\r\n   * @param {string} event\r\n   * @param {Function} callback\r\n   */\r\n  off(event, callback) {\r\n    this.get('eventBus').off(event, callback);\r\n  }\r\n\r\n  /**\r\n   * Emit an event on the underlying {@link EventBus}\r\n   *\r\n   * @param  {string} type\r\n   * @param  {Object} event\r\n   *\r\n   * @return {Object} event processing result (if any)\r\n   */\r\n  _emit(type, event) {\r\n    return this.get('eventBus').fire(type, event);\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed decision.\r\n   *\r\n   * @return {ModdleElement}\r\n   */\r\n  getDecision() {\r\n    return this._decision;\r\n  }\r\n\r\n  /**\r\n   * Attach viewer to given parent node.\r\n   *\r\n   * @param  {Element} parentNode\r\n   */\r\n  attachTo(parentNode) {\r\n\r\n    if (!parentNode) {\r\n      throw new Error('parentNode required');\r\n    }\r\n\r\n    // ensure we detach from the\r\n    // previous, old parent\r\n    this.detach();\r\n\r\n    parentNode.appendChild(this._container);\r\n\r\n    this._emit('attach', {});\r\n  }\r\n\r\n  /**\r\n   * Detach viewer from parent node, if attached.\r\n   */\r\n  detach() {\r\n\r\n    const container = this._container,\r\n          parentNode = container.parentNode;\r\n\r\n    if (!parentNode) {\r\n      return;\r\n    }\r\n\r\n    this._emit('detach', {});\r\n\r\n    domRemove(container);\r\n  }\r\n\r\n  destroy() {\r\n    super.destroy();\r\n\r\n    this.detach();\r\n  }\r\n\r\n  getModules() {\r\n    return Viewer._getModules();\r\n  }\r\n\r\n  static _getModules() {\r\n    return [\r\n      CoreModule,\r\n      DecisionPropertiesModule,\r\n      LiteralExpressionPropertiesModule,\r\n      PoweredByModule,\r\n      TextareaModule,\r\n      ViewDrdModule\r\n    ];\r\n  }\r\n\r\n  static _createContainer() {\r\n    return domify(\r\n      '<div class=\"dmn-literal-expression-container\"></div>'\r\n    );\r\n  }\r\n\r\n}\r\n"],"file":"Viewer.js"}