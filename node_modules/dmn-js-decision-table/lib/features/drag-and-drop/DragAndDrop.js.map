{"version":3,"sources":["../../../src/features/drag-and-drop/DragAndDrop.js"],"names":["classes","domClasses","domify","queryAll","domQueryAll","remove","domRemove","isInput","isOutput","Row","Col","forEach","TOP","RIGHT","BOTTOM","LEFT","DragAndDrop","components","elementRegistry","eventBus","dragAndDrop","renderer","rules","sheet","container","_renderer","getContainer","removeHighlight","removeFadeOut","_dragImage","_elementRegistry","_dragAndDrop","_rules","_sheet","onGetComponent","cellType","col","row","e","startDrag","title","on","event","dragContext","draggedElement","hoverEl","dropIndex","getTargetColIndex","allowed","index","targetEl","originalEvent","lastPosition","newPosition","getVerticalPosition","getHorizontalPosition","highlightRow","highlightCol","verticalPosition","rowId","dataset","get","targetRow","getTargetRow","getRoot","rows","horizontalPosition","colId","targetCol","getTargetCol","cols","_cleanup","element","document","body","appendChild","dataTransfer","setDragImage","fadeOutRow","fadeOutCol","$inject","cellEl","indexOf","dragOverCell","position","cells","cell","isNode","add","id","dragOverElement","bounds","getBoundingClientRect","clientX","left","width","clientY","top","height","draggedRow","getRowBelow","getRowAbove","draggedCol","getColRight","getColLeft","Math","max","min","length","firstOutput","filter","firstOutputIndex","inputs","lastInput","lastInputIndex","node","nodeType"],"mappings":"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","sourcesContent":["import {\r\n  classes as domClasses,\r\n  domify,\r\n  queryAll as domQueryAll,\r\n  remove as domRemove\r\n} from 'min-dom';\r\n\r\nimport { isInput, isOutput } from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nimport { Row, Col } from 'table-js/lib/model';\r\n\r\nimport { forEach } from 'min-dash';\r\n\r\nconst TOP = 'top',\r\n      RIGHT = 'right',\r\n      BOTTOM = 'bottom',\r\n      LEFT = 'left';\r\n\r\n\r\nexport default class DragAndDrop {\r\n\r\n  constructor(\r\n      components, elementRegistry, eventBus,\r\n      dragAndDrop, renderer, rules, sheet) {\r\n\r\n    this._elementRegistry = elementRegistry;\r\n    this._dragAndDrop = dragAndDrop;\r\n    this._renderer = renderer;\r\n    this._rules = rules;\r\n    this._sheet = sheet;\r\n\r\n    // provide drag handle for drag and drop\r\n    components.onGetComponent('cell-inner', ({ cellType, col, row }) => {\r\n      if (cellType === 'rule-index') {\r\n        return () => <span\r\n          draggable=\"true\"\r\n          onDragStart={ e => this.startDrag(row, e) }\r\n          className=\"dmn-icon-drag vertical\"\r\n          title=\"Move rule\">&nbsp;</span>;\r\n      } else if (cellType === 'input-cell' || cellType === 'output-cell') {\r\n\r\n        let title = `Move ${isInput(col) ? 'Input' : 'Output' }`;\r\n\r\n        return () => <span\r\n          draggable=\"true\"\r\n          onDragStart={ e => this.startDrag(col, e) }\r\n          className=\"dmn-icon-drag horizontal\"\r\n          title={ title }></span>;\r\n      }\r\n    });\r\n\r\n    // validate allowed rules\r\n    eventBus.on('dragAndDrop.dragEnter', (event) => {\r\n\r\n      const {\r\n        dragContext\r\n      } = event;\r\n\r\n      const {\r\n        draggedElement,\r\n        hoverEl\r\n      } = dragContext;\r\n\r\n      // can always drag rows\r\n      if (draggedElement instanceof Row) {\r\n        return true;\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        const dropIndex = getTargetColIndex(hoverEl, this._elementRegistry, this._sheet);\r\n\r\n        // cannot drop as we cannot compute the drop index\r\n        if (dropIndex === -1) {\r\n          return false;\r\n        }\r\n\r\n        const allowed = this._rules.allowed('col.move', {\r\n          col: draggedElement,\r\n          index: dropIndex\r\n        });\r\n\r\n        return allowed;\r\n      }\r\n\r\n      return false;\r\n    });\r\n\r\n    // clear previous UI\r\n    eventBus.on('dragAndDrop.dragLeave', (event) => {\r\n\r\n      const {\r\n        dragContext\r\n      } = event;\r\n\r\n      const {\r\n        targetEl\r\n      } = dragContext;\r\n\r\n      if (!targetEl) {\r\n        return;\r\n      }\r\n\r\n      const container = this._renderer.getContainer();\r\n\r\n      removeHighlight(container);\r\n    });\r\n\r\n    // update UI\r\n    eventBus.on('dragAndDrop.dragOver', (event) => {\r\n\r\n      const {\r\n        dragContext,\r\n        originalEvent\r\n      } = event;\r\n\r\n      const {\r\n        draggedElement,\r\n        lastPosition,\r\n        targetEl\r\n      } = dragContext;\r\n\r\n      const container = this._renderer.getContainer();\r\n\r\n      if (!targetEl) {\r\n        return false;\r\n      }\r\n\r\n      let newPosition;\r\n\r\n      if (draggedElement instanceof Row) {\r\n        newPosition = getVerticalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        newPosition = getHorizontalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n      }\r\n\r\n      // nothing to do\r\n      if (lastPosition === newPosition) {\r\n        return true;\r\n      }\r\n\r\n      // remove old highlight\r\n      removeHighlight(container);\r\n\r\n      if (draggedElement instanceof Row) {\r\n\r\n        if (newPosition === TOP) {\r\n\r\n          // drop above\r\n          highlightRow(targetEl, container, 'top');\r\n        } else {\r\n\r\n          // drop below\r\n          highlightRow(targetEl, container, 'bottom');\r\n        }\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        if (newPosition === LEFT) {\r\n\r\n          // drop left\r\n          highlightCol(targetEl, container, 'left');\r\n        } else {\r\n\r\n          // drop right\r\n          highlightCol(targetEl, container, 'right');\r\n        }\r\n      }\r\n\r\n      // remember position\r\n      dragContext.lastPosition = newPosition;\r\n\r\n      // allowed\r\n      return true;\r\n    });\r\n\r\n\r\n    // perform drop operation\r\n    eventBus.on('dragAndDrop.drop', (event) => {\r\n\r\n      const {\r\n        dragContext,\r\n        originalEvent\r\n      } = event;\r\n\r\n      const {\r\n        draggedElement,\r\n        targetEl\r\n      } = dragContext;\r\n\r\n      if (!targetEl) {\r\n        return false;\r\n      }\r\n\r\n      if (draggedElement instanceof Row) {\r\n        const verticalPosition = getVerticalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n\r\n        const rowId = targetEl.dataset.rowId,\r\n              row = this._elementRegistry.get(rowId);\r\n\r\n        if (!row || row === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        const targetRow = getTargetRow(\r\n          draggedElement,\r\n          row,\r\n          verticalPosition,\r\n          this._sheet.getRoot().rows\r\n        );\r\n\r\n        if (targetRow === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        return targetRow;\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        const horizontalPosition = getHorizontalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n\r\n        // no need to check rules; we verified on\r\n        // dragEnter that dropping is O.K.\r\n        const colId = targetEl.dataset.colId,\r\n              col = this._elementRegistry.get(colId);\r\n\r\n        if (!col || col === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        const targetCol = getTargetCol(\r\n          draggedElement,\r\n          col,\r\n          horizontalPosition,\r\n          this._sheet.getRoot().cols\r\n        );\r\n\r\n        if (targetCol === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        return targetCol;\r\n      }\r\n    });\r\n\r\n    eventBus.on('dragAndDrop.dragEnd', this._cleanup);\r\n  }\r\n\r\n  startDrag(element, event) {\r\n    const container = this._renderer.getContainer();\r\n\r\n    this._dragImage = domify(\r\n      `<span style=\"\r\n          visibility: hidden;\r\n          position: fixed;\r\n          top: -10000px\r\n      \"></span>`\r\n    );\r\n\r\n    // needs to be present in DOM\r\n    document.body.appendChild(this._dragImage);\r\n\r\n    // QUIRK: not supported by Edge and Internet Explorer\r\n    if (event.dataTransfer.setDragImage) {\r\n      event.dataTransfer.setDragImage(this._dragImage, 0, 0);\r\n    }\r\n\r\n    if (element instanceof Row) {\r\n      fadeOutRow(element, container);\r\n    } else if (element instanceof Col) {\r\n      fadeOutCol(element, container);\r\n    }\r\n\r\n    this._dragAndDrop.startDrag(element, event);\r\n  }\r\n\r\n  _cleanup = () => {\r\n    const container = this._renderer.getContainer();\r\n\r\n    removeHighlight(container);\r\n    removeFadeOut(container);\r\n\r\n    if (this._dragImage) {\r\n      domRemove(this._dragImage);\r\n\r\n      this._dragImage = null;\r\n    }\r\n  }\r\n\r\n}\r\n\r\nDragAndDrop.$inject = [\r\n  'components',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'dragAndDrop',\r\n  'renderer',\r\n  'rules',\r\n  'sheet'\r\n];\r\n\r\n// helpers //////////\r\n\r\nfunction getTargetColIndex(cellEl, elementRegistry, sheet) {\r\n  const targetCol = elementRegistry.get(cellEl.dataset.colId);\r\n\r\n  if (!targetCol) {\r\n    return -1;\r\n  }\r\n\r\n  const { cols } = sheet.getRoot();\r\n\r\n  return cols.indexOf(targetCol);\r\n}\r\n\r\nfunction highlightRow(dragOverCell, container, position) {\r\n  const rowId = dragOverCell.dataset.rowId;\r\n\r\n  if (!rowId) {\r\n    return;\r\n  }\r\n\r\n  const cells = domQueryAll(`[data-row-id=${rowId}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragover');\r\n      domClasses(cell).add(position);\r\n    }\r\n  });\r\n}\r\n\r\nfunction highlightCol(dragOverCell, container, position) {\r\n  const colId = dragOverCell.dataset.colId;\r\n\r\n  if (!colId) {\r\n    return;\r\n  }\r\n\r\n  const cells = domQueryAll(`[data-col-id=${colId}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragover');\r\n      domClasses(cell).add(position);\r\n    }\r\n  });\r\n}\r\n\r\nfunction removeHighlight(container) {\r\n  const cells = domQueryAll('.dragover', container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).remove('dragover');\r\n      domClasses(cell).remove('top');\r\n      domClasses(cell).remove('right');\r\n      domClasses(cell).remove('bottom');\r\n      domClasses(cell).remove('left');\r\n    }\r\n  });\r\n}\r\n\r\nfunction fadeOutRow(row, container) {\r\n  const cells = domQueryAll(`[data-row-id=${row.id}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragged');\r\n    }\r\n  });\r\n}\r\n\r\nfunction fadeOutCol(col, container) {\r\n  const cells = domQueryAll(`[data-col-id=${col.id}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragged');\r\n    }\r\n  });\r\n}\r\n\r\nfunction removeFadeOut(container) {\r\n  const cells = domQueryAll('.dragged', container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).remove('dragged');\r\n    }\r\n  });\r\n}\r\n\r\nfunction getHorizontalPosition(event, dragOverElement) {\r\n  const bounds = dragOverElement.getBoundingClientRect();\r\n\r\n  return event.clientX < (bounds.left + bounds.width / 2)\r\n    ? LEFT\r\n    : RIGHT;\r\n}\r\n\r\nfunction getVerticalPosition(event, dragOverElement) {\r\n  const bounds = dragOverElement.getBoundingClientRect();\r\n\r\n  return event.clientY < (bounds.top + bounds.height / 2)\r\n    ? TOP\r\n    : BOTTOM;\r\n}\r\n\r\nfunction getTargetRow(draggedRow, targetRow, verticalPosition, rows) {\r\n  if (rows.indexOf(draggedRow) > rows.indexOf(targetRow)) {\r\n    targetRow = getRowBelow(targetRow, rows);\r\n  }\r\n\r\n  if (verticalPosition === TOP) {\r\n\r\n    // return row above or row\r\n    return getRowAbove(targetRow, rows);\r\n  } else {\r\n\r\n    // return row\r\n    return targetRow;\r\n  }\r\n}\r\n\r\nfunction getTargetCol(draggedCol, targetCol, horizontalPosition, cols) {\r\n  if (cols.indexOf(draggedCol) > cols.indexOf(targetCol)) {\r\n    targetCol = getColRight(targetCol, cols);\r\n  }\r\n\r\n  if (horizontalPosition === LEFT) {\r\n\r\n    // return col left or col\r\n    return getColLeft(targetCol, cols);\r\n  } else {\r\n\r\n    // return col\r\n    return targetCol;\r\n  }\r\n}\r\n\r\nfunction getRowAbove(row, rows) {\r\n  const index = rows.indexOf(row);\r\n\r\n  return rows[ Math.max(0, index - 1) ];\r\n}\r\n\r\nfunction getRowBelow(row, rows) {\r\n  const index = rows.indexOf(row);\r\n\r\n  return rows[ Math.min(rows.length - 1, index + 1) ];\r\n}\r\n\r\nfunction getColLeft(col, cols) {\r\n  const index = cols.indexOf(col);\r\n\r\n  if (isOutput(col)) {\r\n    const firstOutput = cols.filter(col => isOutput(col))[0];\r\n\r\n    const firstOutputIndex = cols.indexOf(firstOutput);\r\n\r\n    return cols[ Math.max(firstOutputIndex, index - 1) ];\r\n  }\r\n\r\n  return cols[ Math.max(0, index - 1) ];\r\n}\r\n\r\nfunction getColRight(col, cols) {\r\n  const index = cols.indexOf(col);\r\n\r\n  if (isInput(col)) {\r\n    const inputs = cols.filter(col => isInput(col));\r\n\r\n    const lastInput = inputs[ inputs.length - 1 ];\r\n\r\n    const lastInputIndex = cols.indexOf(lastInput);\r\n\r\n    return cols[ Math.min(lastInputIndex, index + 1) ];\r\n  }\r\n\r\n  return cols[ Math.min(cols.length - 1, index + 1) ];\r\n}\r\n\r\n// QUIRK: PhantomJS requires check if actual DOM node\r\nfunction isNode(node) {\r\n  return node && (node.nodeType === 1 || node.nodeType == 11);\r\n}"],"file":"DragAndDrop.js"}