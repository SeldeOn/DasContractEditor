{"version":3,"sources":["../../../../src/features/modeling/cmd/UpdateAllowedValuesHandler.js"],"names":["is","UpdateAllowedValuesHandler","dmnFactory","moddle","modeling","_dmnFactory","_moddle","_modeling","context","element","allowedValues","isInput","inputValues","oldAllowedValues","text","isNull","create","join","outputValues","$inject","value"],"mappings":"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","sourcesContent":["import { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\n/**\n * A handler that implements adding/removing allowed values.\n */\nexport default class UpdateAllowedValuesHandler {\n\n  constructor(dmnFactory, moddle, modeling) {\n    this._dmnFactory = dmnFactory;\n    this._moddle = moddle;\n    this._modeling = modeling;\n  }\n\n  /**\n   * <do>\n   */\n  execute(context) {\n    const {\n      element,\n      allowedValues\n    } = context;\n\n    const isInput = is(element, 'dmn:InputClause');\n\n    if (isInput) {\n\n      if (element.inputValues) {\n        context.oldAllowedValues = element.inputValues.text;\n      } else {\n\n        if (!isNull(allowedValues)) {\n          element.inputValues = this._dmnFactory.create('dmn:UnaryTests', {\n            text: ''\n          });\n        }\n\n      }\n\n      if (isNull(allowedValues)) {\n        if (element.inputValues) {\n          delete element.inputValues;\n        }\n      } else {\n        element.inputValues.text = allowedValues.join(',');\n      }\n\n    } else {\n\n      if (element.outputValues && element) {\n        context.oldAllowedValues = element.outputValues.text;\n      } else {\n\n        if (!isNull(allowedValues)) {\n          element.outputValues = this._dmnFactory.create('dmn:UnaryTests', {\n            text: ''\n          });\n        }\n\n      }\n\n      if (isNull(allowedValues)) {\n        if (element.outputValues) {\n          delete element.outputValues;\n        }\n      } else {\n        element.outputValues.text = allowedValues.join(',');\n      }\n\n\n    }\n\n    return element;\n  }\n\n\n  /**\n   * <undo>\n   */\n  revert(context) {\n    const {\n      element,\n      oldAllowedValues\n    } = context;\n\n    const isInput = is(element, 'dmn:InputClause');\n\n    if (isInput) {\n\n      if (oldAllowedValues) {\n\n        if (!element.inputValues) {\n          element.inputValues = this._dmnFactory.create('dmn:UnaryTests', {\n            text: ''\n          });\n        }\n\n        element.inputValues.text = oldAllowedValues;\n\n      } else {\n        delete element.inputValues;\n      }\n\n    } else {\n\n      if (oldAllowedValues) {\n\n        if (!element.outputValues) {\n          element.outputValues = this._dmnFactory.create('dmn:UnaryTests', {\n            text: ''\n          });\n        }\n\n        element.outputValues.text = oldAllowedValues;\n\n      } else {\n        delete element.outputValues;\n      }\n\n    }\n\n    return element;\n  }\n\n}\n\nUpdateAllowedValuesHandler.$inject = [\n  'dmnFactory',\n  'moddle',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction isNull(value) {\n  return value === null;\n}"],"file":"UpdateAllowedValuesHandler.js"}