{"version":3,"sources":["../../../../src/features/modeling/behavior/IdClaimBehavior.js"],"names":["CommandInterceptor","isArray","IdClaimBehavior","eventBus","moddle","modeling","_ids","ids","_modeling","preExecute","event","context","element","row","col","claimId","businessObject","cells","forEach","cell","id","assigned","$descriptor","properties","property","value","name","v","$type","$inject"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,kBAAP,MAA+B,2CAA/B;AAEA,SAASC,OAAT,QAAwB,UAAxB;;IAGqBC,e;;;;;AAEnB,2BAAYC,QAAZ,EAAsBC,MAAtB,EAA8BC,QAA9B,EAAwC;AAAA;;AAAA;;AACtC,8BAAMF,QAAN;AAEA,UAAKG,IAAL,GAAYF,MAAM,CAACG,GAAnB;AACA,UAAKC,SAAL,GAAiBH,QAAjB;;AAEA,UAAKI,UAAL,CAAgB,CACd,SADc,EAEd,SAFc,CAAhB,EAGG,UAAAC,KAAK,EAAI;AACV,UAAMC,OAAO,GAAGD,KAAK,CAACC,OAAtB;AAAA,UACMC,OAAO,GAAGD,OAAO,CAACE,GAAR,IAAeF,OAAO,CAACG,GADvC;;AAGA,YAAKC,OAAL,CAAaH,OAAO,CAACI,cAArB;;AAEA,UAAIJ,OAAO,CAACK,KAAZ,EAAmB;AACjBL,QAAAA,OAAO,CAACK,KAAR,CAAcC,OAAd,CAAsB,UAAAC,IAAI;AAAA,iBAAI,MAAKJ,OAAL,CAAaI,IAAI,CAACH,cAAlB,CAAJ;AAAA,SAA1B;AACD;AACF,KAZD;;AANsC;AAmBvC;;;;WAED,iBAAQA,cAAR,EAAwB;AAAA;;AAEtB,UAAIA,cAAc,CAACI,EAAf,IAAqB,CAAC,KAAKd,IAAL,CAAUe,QAAV,CAAmBL,cAAc,CAACI,EAAlC,CAA1B,EAAiE;AAC/D,aAAKZ,SAAL,CAAeO,OAAf,CAAuBC,cAAc,CAACI,EAAtC,EAA0CJ,cAA1C;AACD;;AAEDA,MAAAA,cAAc,CAACM,WAAf,CAA2BC,UAA3B,CAAsCL,OAAtC,CAA8C,UAAAM,QAAQ,EAAI;AACxD,YAAMC,KAAK,GAAGT,cAAc,CAACQ,QAAQ,CAACE,IAAV,CAA5B,CADwD,CAGxD;;AACA,YAAI,CAACD,KAAL,EAAY;AACV;AACD,SANuD,CAQxD;;;AACA,YAAIxB,OAAO,CAACwB,KAAD,CAAX,EAAoB;AAClBA,UAAAA,KAAK,CAACP,OAAN,CAAc,UAAAS,CAAC;AAAA,mBAAI,MAAI,CAACZ,OAAL,CAAaY,CAAb,CAAJ;AAAA,WAAf;AACD,SAXuD,CAaxD;;;AACA,YAAIF,KAAK,CAACG,KAAV,EAAiB;AACf,UAAA,MAAI,CAACb,OAAL,CAAaU,KAAb;AACD;AACF,OAjBD;AAmBD;;;;EAhD0CzB,kB;;SAAxBE,e;AAmDrBA,eAAe,CAAC2B,OAAhB,GAA0B,CAAE,UAAF,EAAc,QAAd,EAAwB,UAAxB,CAA1B","sourcesContent":["import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport { isArray } from 'min-dash';\r\n\r\n\r\nexport default class IdClaimBehavior extends CommandInterceptor {\r\n\r\n  constructor(eventBus, moddle, modeling) {\r\n    super(eventBus);\r\n\r\n    this._ids = moddle.ids;\r\n    this._modeling = modeling;\r\n\r\n    this.preExecute([\r\n      'row.add',\r\n      'col.add'\r\n    ], event => {\r\n      const context = event.context,\r\n            element = context.row || context.col;\r\n\r\n      this.claimId(element.businessObject);\r\n\r\n      if (element.cells) {\r\n        element.cells.forEach(cell => this.claimId(cell.businessObject));\r\n      }\r\n    });\r\n  }\r\n\r\n  claimId(businessObject) {\r\n\r\n    if (businessObject.id && !this._ids.assigned(businessObject.id)) {\r\n      this._modeling.claimId(businessObject.id, businessObject);\r\n    }\r\n\r\n    businessObject.$descriptor.properties.forEach(property => {\r\n      const value = businessObject[property.name];\r\n\r\n      // not set\r\n      if (!value) {\r\n        return;\r\n      }\r\n\r\n      // array of moddle elements\r\n      if (isArray(value)) {\r\n        value.forEach(v => this.claimId(v));\r\n      }\r\n\r\n      // moddle element\r\n      if (value.$type) {\r\n        this.claimId(value);\r\n      }\r\n    });\r\n\r\n  }\r\n}\r\n\r\nIdClaimBehavior.$inject = [ 'eventBus', 'moddle', 'modeling' ];"],"file":"IdClaimBehavior.js"}