{"version":3,"sources":["../src/Viewer.js"],"names":["Table","importDecision","assign","domify","remove","domRemove","TranslateModule","annotationsModule","coreModule","decisionTableHeadModule","decisionTablePropertiesModule","decisionRuleIndicesModule","decisionRulesModule","hitPolicyModule","viewDrdModule","PoweredByModule","Viewer","options","container","_createContainer","renderer","_container","decision","self","Promise","resolve","reject","err","_decision","clear","warnings","e","modules","additionalModules","config","baseModules","getModules","extraModules","staticModules","decisionTable","allModules","event","priority","callback","target","get","on","off","type","fire","parentNode","Error","detach","appendChild","_emit","_getModules"],"mappings":"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","sourcesContent":["import Table from 'table-js';\n\nimport { importDecision } from './import/Importer';\n\nimport { assign } from 'min-dash';\n\nimport {\n  domify,\n  remove as domRemove\n} from 'min-dom';\n\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\n\nimport annotationsModule from './features/annotations';\nimport coreModule from './core';\nimport decisionTableHeadModule from './features/decision-table-head';\nimport decisionTablePropertiesModule from './features/decision-table-properties';\nimport decisionRuleIndicesModule from './features/decision-rule-indices';\nimport decisionRulesModule from './features/decision-rules';\nimport hitPolicyModule from './features/hit-policy';\nimport viewDrdModule from './features/view-drd';\nimport PoweredByModule from './features/powered-by';\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenResult} OpenResult\n */\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenError} OpenError\n */\n\n\nexport default class Viewer extends Table {\n\n  constructor(options = {}) {\n    const container = Viewer._createContainer();\n\n    super(assign(options, {\n      renderer: {\n        container\n      }\n    }));\n\n    this._container = container;\n  }\n\n  /**\n   * Open diagram element.\n   *\n   * @param  {ModdleElement} decision\n   * @returns {Promise} Resolves with {OpenResult} when successful\n   * or rejects with {OpenError}\n   */\n  open(decision) {\n    var self = this;\n\n    return new Promise((resolve, reject) => {\n      var err;\n\n      // use try/catch to not swallow synchronous exceptions\n      // that may be raised during model parsing\n      try {\n\n        if (self._decision) {\n\n          // clear existing rendered diagram\n          self.clear();\n        }\n\n        // update decision\n        self._decision = decision;\n\n        // perform import\n        return importDecision(self, decision, function(err, warnings) {\n          if (err) {\n            err.warnings = warnings || [];\n            reject(err);\n          } else {\n            resolve({ warnings: warnings || [] });\n          }\n        });\n      } catch (e) {\n        err = e;\n      }\n\n      // handle synchronously thrown exception\n      if (err) {\n        err.warnings = err.warnings || [];\n        reject(err);\n      } else {\n        resolve({ warnings: [] });\n      }\n    });\n  }\n\n  /**\n   * Initialize the table, returning { modules: [], config }.\n   *\n   * @param  {Object} options\n   *\n   * @return {Object} init config\n   */\n  _init(options) {\n\n    let {\n      modules,\n      additionalModules,\n      ...config\n    } = options;\n\n    let baseModules = modules || this.getModules();\n    let extraModules = additionalModules || [];\n    let staticModules = [\n      {\n        decisionTable: [ 'value', this ]\n      }\n    ];\n\n    let allModules = [\n      PoweredByModule,\n      ...baseModules,\n      ...extraModules,\n      ...staticModules\n    ];\n\n    return {\n      modules: allModules,\n      config\n    };\n  }\n\n  /**\n   * Register an event listener\n   *\n   * Remove a previously added listener via {@link #off(event, callback)}.\n   *\n   * @param {string} event\n   * @param {number} [priority]\n   * @param {Function} callback\n   * @param {Object} [that]\n   */\n  on(event, priority, callback, target) {\n    return this.get('eventBus').on(event, priority, callback, target);\n  }\n\n  /**\n   * De-register an event listener\n   *\n   * @param {string} event\n   * @param {Function} callback\n   */\n  off(event, callback) {\n    this.get('eventBus').off(event, callback);\n  }\n\n  /**\n   * Emit an event on the underlying {@link EventBus}\n   *\n   * @param  {string} type\n   * @param  {Object} event\n   *\n   * @return {Object} event processing result (if any)\n   */\n  _emit(type, event) {\n    return this.get('eventBus').fire(type, event);\n  }\n\n  /**\n   * Attach viewer to given parent node.\n   *\n   * @param  {Element} parentNode\n   */\n  attachTo(parentNode) {\n\n    if (!parentNode) {\n      throw new Error('parentNode required');\n    }\n\n    // ensure we detach from the\n    // previous, old parent\n    this.detach();\n\n    const container = this._container;\n\n    parentNode.appendChild(container);\n\n    this._emit('attach', {});\n  }\n\n  /**\n   * Detach viewer from parent node, if attached.\n   */\n  detach() {\n\n    const container = this._container,\n          parentNode = container.parentNode;\n\n    if (!parentNode) {\n      return;\n    }\n\n    this._emit('detach', {});\n\n    domRemove(container);\n  }\n\n  destroy() {\n    super.destroy();\n\n    this.detach();\n  }\n\n  getModules() {\n    return Viewer._getModules();\n  }\n\n  static _getModules() {\n    return [\n      annotationsModule,\n      coreModule,\n      TranslateModule,\n      decisionTableHeadModule,\n      decisionTablePropertiesModule,\n      decisionRuleIndicesModule,\n      decisionRulesModule,\n      hitPolicyModule,\n      viewDrdModule\n    ];\n  }\n\n  static _createContainer() {\n    return domify(\n      '<div class=\"dmn-decision-table-container\"></div>'\n    );\n  }\n\n}\n"],"file":"Viewer.js"}