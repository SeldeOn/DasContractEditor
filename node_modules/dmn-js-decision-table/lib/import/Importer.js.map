{"version":3,"sources":["../../src/import/Importer.js"],"names":["TableTreeWalker","importDecision","decisionTable","decision","done","importer","get","eventBus","sheet","hasModeling","error","warnings","render","visitor","create","type","parent","clause","rule","table","element","add","parentShape","definitions","message","context","push","walker","canAddMissingEntries","handleDecision","fire","e","elements","getRoot"],"mappings":"AAAA,OAAOA,eAAP,MAA4B,mBAA5B;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASC,cAAT,CAAwBC,aAAxB,EAAuCC,QAAvC,EAAiDC,IAAjD,EAAuD;AAC5D,MAAMC,QAAQ,GAAGH,aAAa,CAACI,GAAd,CAAkB,eAAlB,CAAjB;AAAA,MACMC,QAAQ,GAAGL,aAAa,CAACI,GAAd,CAAkB,UAAlB,CADjB;AAAA,MAEME,KAAK,GAAGN,aAAa,CAACI,GAAd,CAAkB,OAAlB,CAFd;AAIA,MAAIG,WAAW,GAAGP,aAAa,CAACI,GAAd,CAAkB,UAAlB,EAA8B,KAA9B,CAAlB;AAEA,MAAII,KAAJ;AAAA,MACIC,QAAQ,GAAG,EADf;;AAGA,WAASC,MAAT,CAAgBT,QAAhB,EAA0B;AAExB,QAAMU,OAAO,GAAG;AACdC,MAAAA,MADc,kBACPC,IADO,EACDC,MADC,EACOC,MADP,EACeC,IADf,EACqB;AACjC,eAAOb,QAAQ,CAACS,MAAT,CAAgBC,IAAhB,EAAsBC,MAAtB,EAA8BC,MAA9B,EAAsCC,IAAtC,CAAP;AACD,OAHa;AAKdC,MAAAA,KALc,iBAKRC,OALQ,EAKC;AACb,eAAOf,QAAQ,CAACgB,GAAT,CAAaD,OAAb,CAAP;AACD,OAPa;AASdA,MAAAA,OATc,mBASNA,QATM,EASGE,WATH,EASgBC,WAThB,EAS6B;AACzC,eAAOlB,QAAQ,CAACgB,GAAT,CAAaD,QAAb,EAAsBE,WAAtB,EAAmCC,WAAnC,CAAP;AACD,OAXa;AAadb,MAAAA,KAbc,iBAaRc,OAbQ,EAaCC,OAbD,EAaU;AACtBd,QAAAA,QAAQ,CAACe,IAAT,CAAc;AAAEF,UAAAA,OAAO,EAAEA,OAAX;AAAoBC,UAAAA,OAAO,EAAEA;AAA7B,SAAd;AACD;AAfa,KAAhB;AAkBA,QAAME,MAAM,GAAG,IAAI3B,eAAJ,CAAoBa,OAApB,EAA6B;AAAEe,MAAAA,oBAAoB,EAAEnB;AAAxB,KAA7B,CAAf,CApBwB,CAsBxB;;AACAkB,IAAAA,MAAM,CAACE,cAAP,CAAsB1B,QAAtB;AACD;;AAEDI,EAAAA,QAAQ,CAACuB,IAAT,CAAc,qBAAd,EAAqC;AAAE3B,IAAAA,QAAQ,EAAEA;AAAZ,GAArC;;AAEA,MAAI;AACFS,IAAAA,MAAM,CAACT,QAAD,CAAN;AACD,GAFD,CAEE,OAAO4B,CAAP,EAAU;AACVrB,IAAAA,KAAK,GAAGqB,CAAR;AACD;;AAEDxB,EAAAA,QAAQ,CAACuB,IAAT,CAAc,wBAAd,EAAwC;AACtCpB,IAAAA,KAAK,EAAEA,KAD+B;AAEtCC,IAAAA,QAAQ,EAAEA;AAF4B,GAAxC;AAKAJ,EAAAA,QAAQ,CAACuB,IAAT,CAAc,kBAAd,EAAkC;AAChCE,IAAAA,QAAQ,EAAE,CAAExB,KAAK,CAACyB,OAAN,EAAF;AADsB,GAAlC;AAIA7B,EAAAA,IAAI,CAACM,KAAD,EAAQC,QAAR,CAAJ;AACD","sourcesContent":["import TableTreeWalker from './TableTreeWalker';\n\n\n/**\n * Import the decision table into a table.\n *\n * Errors and warnings are reported through the specified callback.\n *\n * @param  {decisionTable} decisionTable instance of DecisionTable\n * @param  {ModdleElement} decision moddle element\n * @param  {Function} done\n *         the callback, invoked with (err, [ warning ]) once the import is done\n */\nexport function importDecision(decisionTable, decision, done) {\n  const importer = decisionTable.get('tableImporter'),\n        eventBus = decisionTable.get('eventBus'),\n        sheet = decisionTable.get('sheet');\n\n  let hasModeling = decisionTable.get('modeling', false);\n\n  let error,\n      warnings = [];\n\n  function render(decision) {\n\n    const visitor = {\n      create(type, parent, clause, rule) {\n        return importer.create(type, parent, clause, rule);\n      },\n\n      table(element) {\n        return importer.add(element);\n      },\n\n      element(element, parentShape, definitions) {\n        return importer.add(element, parentShape, definitions);\n      },\n\n      error(message, context) {\n        warnings.push({ message: message, context: context });\n      }\n    };\n\n    const walker = new TableTreeWalker(visitor, { canAddMissingEntries: hasModeling });\n\n    // import\n    walker.handleDecision(decision);\n  }\n\n  eventBus.fire('import.render.start', { decision: decision });\n\n  try {\n    render(decision);\n  } catch (e) {\n    error = e;\n  }\n\n  eventBus.fire('import.render.complete', {\n    error: error,\n    warnings: warnings\n  });\n\n  eventBus.fire('elements.changed', {\n    elements: [ sheet.getRoot() ]\n  });\n\n  done(error, warnings);\n}\n"],"file":"Importer.js"}